<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gestão Clínica — Painel</title>

  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
    .hidden { display:none; }

    .row { display: flex; gap: 24px; align-items: flex-start; }
    .col { flex: 1; min-width: 320px; }
    .box { border: 1px solid #ddd; border-radius: 10px; padding: 12px; }
    .list { list-style: none; padding: 0; margin: 0; }
    .list li { padding: 10px; border-bottom: 1px solid #eee; cursor: pointer; }
    .list li:hover { background: #f7f7f7; }
    .muted { color: #666; }
    button { padding: 8px 12px; border-radius: 10px; border: 1px solid #ddd; background:#fff; }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>

<!-- LOADING -->
<div id="loading" class="box">
  <div class="muted">A verificar sessão…</div>
</div>

<!-- LOGIN -->
<div id="login" class="box hidden">
  <div class="muted">Sessão não encontrada.</div>
  <button id="goLogin">Ir para login</button>
</div>

<!-- APP -->
<div id="app" class="hidden">

  <div class="box" style="margin-bottom:12px;">
    <strong>Painel Clínico</strong>
    <button id="logout" style="float:right;">Logout</button>
  </div>

  <div class="row">
    <div class="col box">
      <h3>Clínicas</h3>
      <ul id="clinics" class="list"></ul>
    </div>
    <div class="col box">
      <h3>Doentes</h3>
      <ul id="patients" class="list"></ul>
    </div>
  </div>

</div>

<script>
const sb = supabase.createClient(
  "https://vfrmjfveclfwxcdknlvs.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZmcm1qZnZlY2xmd3hjZGtubHZzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg2ODM1NTQsImV4cCI6MjA4NDI1OTU1NH0.jSQMR2jar0UxrDeXpYBOvFSj8ucjPWOdaBRKKr543hc"
);

const $ = id => document.getElementById(id);

async function init() {
  const { data } = await sb.auth.getSession();

  $("loading").classList.add("hidden");

  if (!data.session) {
    $("login").classList.remove("hidden");
    $("goLogin").onclick = () => location.href = "/index.html";
    return;
  }

  $("app").classList.remove("hidden");

  $("logout").onclick = async () => {
    await sb.auth.signOut();
    location.href = "/index.html";
  };

  loadClinics();
}

async function loadClinics() {
  const { data } = await sb.from("clinics").select("id,name");
  $("clinics").innerHTML = "";
  data.forEach(c => {
    const li = document.createElement("li");
    li.textContent = c.name;
    $("clinics").appendChild(li);
  });
}

init();
</script>
</body>
</html>